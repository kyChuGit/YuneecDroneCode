#!nsh
#
# @name Generic Hexarotor x geometry
#
# @type Hexarotor x
#
# @output AUX1 feed-through of RC AUX1 channel
# @output AUX2 feed-through of RC AUX2 channel
# @output AUX3 feed-through of RC AUX3 channel
#
# @maintainer Anton Babushkin <anton@px4.io>
#

sh /etc/init.d/rc.mc_defaults

if [ $AUTOCNF == yes ]
then
	param set MAV_TYPE 13

	#
	# Attitude parameters setting for TAP
	#

	# pitch angle & rate setting
	param set MC_PITCHRATE_P 0.06
	param set MC_PITCHRATE_I 0.004
	param set MC_PITCHRATE_D 0.0012
	param set MC_PITCHRATE_MAX 300.0
	param set MC_PITCH_P 4.5

	# roll angle & rate setting
	param set MC_ROLLRATE_P 0.08
	param set MC_ROLLRATE_I 0.006
	param set MC_ROLLRATE_D 0.0015
	param set MC_ROLLRATE_MAX 300.0
	param set MC_ROLL_P 4.5

	# yaw angle & rate setting
	param set MC_YAWRATE_P 0.12
	param set MC_YAWRATE_I 0.05
	param set MC_YAWRATE_MAX 120.0
	param set MC_YAW_P 3.0

	#
	# Throttle max/min setting
	#
	param set MPC_THR_MAX 0.94
	param set MPC_THR_MIN 0.1

	#
	# Maximum tilt angle
	#
	param set MPC_TILTMAX_AIR 35.0

	#
	# Battery setting
	#
	param set BAT_N_CELLS 4
	param set BAT_V_CHARGED 4.2
	
	#
	# Flight modes
	#
	param set COM_FLTMODE1 5
	param set COM_FLTMODE4 2
	param set COM_FLTMODE6 0
	
	#
	# RTL settings
	#
	param set RTL_DESCEND_ALT 5.0
	param set RTL_RETURN_ALT 10.0
	param set RTL_LAND_DELAY 0.0
	
	#
	# ST16 RC settings
	# (speed slider in top right corner has to be on max!)
	param set RC_CHAN_CNT 12
	param set RC_MAP_PITCH 3
	param set RC_MAP_ROLL 2
	param set RC_MAP_THROTTLE 1
	param set RC_MAP_YAW 4
	param set RC_MAP_AUX1 8
	param set RC_MAP_AUX2 7
	param set RC_MAP_AUX3 9
	param set RC_MAP_AUX4 10
	
	param set RC1_MAX 1970.0
	param set RC1_MIN 1053.0
	param set RC1_TRIM 1053.0
	param set RC2_MAX 1970.0
	param set RC2_MIN 1057.0
	param set RC2_REV -1.0
	param set RC2_TRIM 1515.0
	param set RC3_MAX 1969.0
	param set RC3_MIN 1056.0
	param set RC3_TRIM 1515.0
	param set RC4_MAX 1939.0
	param set RC4_MIN 1055.0
	param set RC4_REV -1.0
	param set RC4_TRIM 1515.0
	param set RC5_MAX 1969.0
	param set RC5_MIN 1060.0
	param set RC5_TRIM 1514.0
	param set RC7_MAX 1970.0
	param set RC7_MIN 1056.0
	param set RC7_TRIM 1513.0
	param set RC8_MAX 1968.0
	param set RC8_MIN 1055.0
	param set RC8_TRIM 1511.0
	param set RC10_MAX 1969.0
	param set RC10_MIN 1060.0
	param set RC10_TRIM 1514.0
	param set RC11_MAX 2197.0
	param set RC11_MIN 832.0
	param set RC11_TRIM 1514.0
fi

#
# Landing gear settings
#
param set RC_MAP_GEAR_SW 11
param set RC11_REV -1.0

#
# Arm button settings
#
param set RC_MAP_ARM_SW 12
param set COM_ARM_SWISBTN 1

if tap_esc start -d /dev/ttyS4 -n 6
then
fi
set OUTPUT_MODE tap_esc

set MIXER hexa_x
