#!nsh
#
# @name Generic Hexarotor x geometry
#
# @type Hexarotor x
#
# @output AUX1 feed-through of RC AUX1 channel
# @output AUX2 feed-through of RC AUX2 channel
# @output AUX3 feed-through of RC AUX3 channel
#
# @maintainer Anton Babushkin <anton@px4.io>
#

sh /etc/init.d/rc.mc_defaults

if [ $AUTOCNF == yes ]
then
	param set MAV_TYPE 13

	#
	# Attitude parameters setting for TAP
	#

	# pitch angle & rate setting
	param set MC_PITCHRATE_P 0.13
	param set MC_PITCHRATE_I 0.000
	param set MC_PITCHRATE_D 0.0032
	param set MC_PITCHRATE_MAX 360.0
	param set MC_PITCH_P 4.5

	# roll angle & rate setting
	param set MC_ROLLRATE_P 0.13
	param set MC_ROLLRATE_I 0.000
	param set MC_ROLLRATE_D 0.0032
	param set MC_ROLLRATE_MAX 360.0
	param set MC_ROLL_P 4.5

	# yaw angle & rate setting
	param set MC_YAWRATE_P 0.12
	param set MC_YAWRATE_I 0.05
	param set MC_YAWRATE_MAX 120.0
	param set MC_YAW_P 3.0

	#
	# Throttle max/min setting
	#
	param set MPC_THR_MAX 0.94
	param set MPC_THR_MIN 0.1

	#
	# Maximum tilt angle
	#
	param set MPC_TILTMAX_AIR 35.0

	#
	# Battery setting
	#
	param set BAT_N_CELLS 4
	param set BAT_V_CHARGED 4.2

	#
	# Flight modes
	#
	param set COM_FLTMODE1 5
	param set COM_FLTMODE4 2
	param set COM_FLTMODE6 0

	#
	# ST16 RC settings
	# (speed slider in top right corner has to be on max!)
	param set RC_CHAN_CNT 12
	param set RC_MAP_PITCH 3
	param set RC_MAP_ROLL 2
	param set RC_MAP_THROTTLE 1
	param set RC_MAP_YAW 4
	param set RC_MAP_AUX1 8
	param set RC_MAP_AUX2 7
	param set RC_MAP_AUX3 9
	param set RC_MAP_AUX4 10
	
	param set RC1_MAX 1833.0
	param set RC1_MIN 1163.0
	param set RC1_REV 1.0
	param set RC1_TRIM 1163.0 # 1156.0 would be better but fails RC calibration check
	param set RC2_MAX 1833.0
	param set RC2_MIN 1163.0
	param set RC2_REV -1.0
	param set RC2_TRIM 1500.0
	param set RC3_MAX 1833.0
	param set RC3_MIN 1163.0
	param set RC3_REV 1.0
	param set RC3_TRIM 1500.0
	param set RC4_MAX 1764.0
	param set RC4_MIN 1233.0
	param set RC4_REV -1.0
	param set RC4_TRIM 1500.0
	param set RC5_MAX 1833.0
	param set RC5_MIN 1167.0
	param set RC5_TRIM 1500.0
	param set RC6_MAX 2000.0
	param set RC6_MIN 1000.0
	param set RC6_TRIM 1500.0
	param set RC7_MAX 1833.0
	param set RC7_MIN 1163.0
	param set RC7_TRIM 1500.0
	param set RC8_MAX 1833.0
	param set RC8_MIN 1163.0
	param set RC8_TRIM 1500.0
	param set RC9_MAX 1833.0
	param set RC9_MIN 1067.0
	param set RC9_TRIM 1500.0
	param set RC10_MAX 1833.0
	param set RC10_MIN 1067.0
	param set RC10_TRIM 1500.0
	param set RC11_MAX 2000.0
	param set RC11_MIN 1000.0
	param set RC11_REV -1.0
	param set RC11_TRIM 1500.0

	#
	# Switch mapping
	#
	param set RC_MAP_FLTMODE 5
	param set RC_MAP_GEAR_SW 11

	#
	# Arm button settings
	#
	param set RC_MAP_ARM_SW 12
	param set COM_ARM_SWISBTN 1
fi

if tap_esc start -d /dev/ttyS4 -n 6
then
fi
set OUTPUT_MODE tap_esc

set MIXER hexa_x
